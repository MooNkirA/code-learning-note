## 1. å‰ç«¯å¼€å‘çš„æ¼”å˜

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå‰ç«¯çš„å¼€å‘ç»å†äº†å››ä¸ªé˜¶æ®µï¼Œç›®å‰å¤„äºç¬¬å››ä¸ªé˜¶æ®µã€‚è¿™å››ä¸ªé˜¶æ®µåˆ†åˆ«æ˜¯ï¼š

### 1.1. é˜¶æ®µä¸€ï¼šé™æ€é¡µé¢é˜¶æ®µ

åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­å‰ç«¯é¡µé¢éƒ½æ˜¯é™æ€çš„ï¼Œæ‰€æœ‰å‰ç«¯ä»£ç å’Œå‰ç«¯æ•°æ®éƒ½æ˜¯åç«¯ç”Ÿæˆçš„ã€‚å‰ç«¯åªæ˜¯çº¯ç²¹çš„å±•ç¤ºåŠŸèƒ½ï¼Œjsè„šæœ¬çš„ä½œç”¨åªæ˜¯å¢åŠ ä¸€äº›ç‰¹æ®Šæ•ˆæœï¼Œæ¯”å¦‚é‚£æ—¶å¾ˆæµè¡Œç”¨è„šæœ¬æ§åˆ¶é¡µé¢ä¸Šé£æ¥é£å»çš„å¹¿å‘Šã€‚

é‚£æ—¶çš„ç½‘ç«™å¼€å‘ï¼Œé‡‡ç”¨çš„æ˜¯åç«¯ MVC æ¨¡å¼ã€‚

- Model ï¼ˆæ¨¡å‹å±‚ï¼‰ï¼šæä¾›/ä¿å­˜æ•°æ®
- Controller ï¼ˆæ§åˆ¶å±‚ï¼‰ï¼šæ•°æ®å¤„ç†ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘
- View ï¼ˆè§†å›¾å±‚ï¼‰ï¼šå±•ç¤ºæ•°æ®ï¼Œæä¾›ç”¨æˆ·ç•Œé¢

å‰ç«¯åªæ˜¯åç«¯ MVC çš„ Vã€‚

### 1.2. é˜¶æ®µäºŒï¼šajax é˜¶æ®µ

2004å¹´ï¼ŒAJAX æŠ€æœ¯è¯ç”Ÿï¼Œæ”¹å˜äº†å‰ç«¯å¼€å‘ã€‚Gmail å’Œ Google åœ°å›¾è¿™æ ·é©å‘½æ€§çš„äº§å“å‡ºç°ï¼Œä½¿å¾—å¼€å‘è€…å‘ç°ï¼Œå‰ç«¯çš„ä½œç”¨ä¸ä»…ä»…æ˜¯å±•ç¤ºé¡µé¢ï¼Œè¿˜å¯ä»¥ç®¡ç†æ•°æ®å¹¶ä¸ç”¨æˆ·äº’åŠ¨ã€‚

å°±æ˜¯ä»è¿™ä¸ªé˜¶æ®µå¼€å§‹ï¼Œå‰ç«¯è„šæœ¬å¼€å§‹å˜å¾—å¤æ‚ï¼Œä¸å†ä»…ä»…æ˜¯ä¸€äº›ç©å…·æ€§çš„åŠŸèƒ½ã€‚

### 1.3. é˜¶æ®µä¸‰ï¼šå‰ç«¯ MVC é˜¶æ®µ

2010å¹´ï¼Œç¬¬ä¸€ä¸ªå‰ç«¯ MVC æ¡†æ¶ Backbone.js è¯ç”Ÿã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯æŠŠ MVC æ¨¡å¼æ¬åˆ°äº†å‰ç«¯ï¼Œä½†æ˜¯åªæœ‰ Mï¼ˆè¯»å†™æ•°æ®ï¼‰å’Œ Vï¼ˆå±•ç¤ºæ•°æ®ï¼‰ï¼Œæ²¡æœ‰ Cï¼ˆå¤„ç†æ•°æ®ï¼‰ã€‚

æœ‰äº›æ¡†æ¶æå‡ºäº† MVVMæ¨¡å¼ï¼Œç”¨ View Model ä»£æ›¿ Controllerã€‚Model æ‹¿åˆ°æ•°æ®ä»¥åï¼ŒView Model å°†æ•°æ®å¤„ç†æˆè§†å›¾å±‚ï¼ˆViewï¼‰éœ€è¦çš„æ ¼å¼ï¼Œåœ¨è§†å›¾å±‚å±•ç¤ºå‡ºæ¥ã€‚

### 1.4. é˜¶æ®µå››ï¼šSPA é˜¶æ®µ

å‰ç«¯å¯ä»¥åšåˆ°è¯»å†™æ•°æ®ã€åˆ‡æ¢è§†å›¾ã€ç”¨æˆ·äº¤äº’ï¼Œè¿™æ„å‘³ç€ï¼Œç½‘é¡µå…¶å®æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯ä¿¡æ¯çš„çº¯å±•ç¤ºã€‚è¿™ç§å•å¼ ç½‘é¡µçš„åº”ç”¨ç¨‹åºç§°ä¸º SPAï¼ˆsingle-page-applicationï¼‰ã€‚

2010å¹´åï¼Œå‰ç«¯å·¥ç¨‹å¸ˆä»å¼€å‘é¡µé¢ï¼ˆåˆ‡æ¨¡æ¿ï¼‰ï¼Œé€æ¸å˜æˆäº†å¼€å‘â€œå‰ç«¯åº”ç”¨â€ï¼ˆè·‘åœ¨æµè§ˆå™¨é‡Œé¢çš„åº”ç”¨ç¨‹åºï¼‰ã€‚

ç›®å‰ï¼Œæœ€æµè¡Œçš„å‰ç«¯æ¡†æ¶ Vueã€Angularã€React ç­‰ç­‰ï¼Œéƒ½å±äº SPA å¼€å‘æ¡†æ¶ã€‚

## 2. ReactJS ç®€ä»‹

> - React.js è‹±æ–‡å®˜ç½‘ï¼š https://react.dev
> - React.js ä¸­æ–‡å®˜ç½‘ï¼š https://zh-hans.react.dev

ReactJSï¼Œå°±æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web å’ŒåŸç”Ÿç”¨æˆ·äº¤äº’ç•Œé¢çš„ JavaScript æ¡†æ¶ï¼Œæ˜¯ Facebookï¼ˆç°æ”¹åä¸º Metaï¼‰ å¼€å‘çš„ä¸€æ¬¾çš„ JS æ¡†æ¶ã€‚ReactJS æŠŠå¤æ‚çš„é¡µé¢ï¼Œæ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„ç»„ä»¶ï¼Œå°†è¿™äº›ç»„ä»¶ä¸€ä¸ªä¸ªçš„æ‹¼è£…èµ·æ¥ï¼Œå°±ä¼šå‘ˆç°å¤šæ ·çš„é¡µé¢ã€‚ReactJS å¯ä»¥ç”¨äº MVC æ¶æ„ï¼Œä¹Ÿå¯ä»¥ç”¨äº MVVM æ¶æ„ï¼Œæˆ–è€…åˆ«çš„æ¶æ„ã€‚

ReactJS åœˆå†…çš„ä¸€äº›æ¡†æ¶ç®€ä»‹ï¼š

- Flux
    - Flux æ˜¯ Facebook ç”¨æˆ·å»ºç«‹å®¢æˆ·ç«¯ Web åº”ç”¨çš„å‰ç«¯æ¶æ„ï¼Œå®ƒé€šè¿‡åˆ©ç”¨ä¸€ä¸ªå•å‘çš„æ•°æ®æµè¡¥å……äº† React çš„ç»„åˆè§†å›¾ç»„ä»¶ï¼Œè¿™æ›´æ˜¯ä¸€ç§æ¨¡å¼è€Œéæ¡†æ¶ã€‚
- Redux
    - Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚Redux å¯ä»¥è®© React ç»„ä»¶çŠ¶æ€å…±äº«å˜å¾—ç®€å•ã€‚
- Ant Design of React
    - é˜¿é‡Œå¼€æºçš„åŸºäº React çš„ä¼ä¸šçº§åå°äº§å“ï¼Œå…¶ä¸­é›†æˆäº†å¤šç§æ¡†æ¶ï¼ŒåŒ…å«äº†ä¸Šé¢æåˆ°çš„ Fluxã€Reduxã€‚
    - Ant Design æä¾›äº†ä¸°å¯Œçš„ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼šæŒ‰é’®ã€è¡¨å•ã€è¡¨æ ¼ã€å¸ƒå±€ã€åˆ†é¡µã€æ ‘ç»„ä»¶ã€æ—¥å†ç­‰ã€‚

## 3. æ­å»ºç¯å¢ƒï¼ˆæ¡ˆä¾‹ä½¿ç”¨ UmiJsï¼‰

### 3.1. åˆ›å»ºé¡¹ç›®

æœ¬æ¡ˆä¾‹ä½¿ç”¨é€‰æ‹©ä½¿ç”¨ UmiJS ä½œä¸ºæ„å»ºå·¥å…·ã€‚

1. åˆ›å»ºå·¥ç¨‹ã€‚*ï¼ˆå¦‚æœä½¿ç”¨vscodeï¼Œå°±åˆ›å»ºç©ºçš„æ–‡ä»¶å¤¹å³å¯ï¼‰*
2. åœ¨å‘½ä»¤è¡Œçª—å£ï¼Œåœ¨å·¥ç¨‹æ‰€åœ¨è·¯å¾„ä¸Šè¾“å…¥å‘½ä»¤ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼š

```shell
npm init -y
```

![](images/20190421221552264_20263.png)

![](images/20190421221633309_8209.png)

3. åœ¨å‘½ä»¤è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæ·»åŠ umiçš„ä¾èµ–

```shell
# é¡¹ç›®ä¸­æ·»åŠ umiçš„ä¾èµ–
npm add umi --dev
```

### 3.2. ç¼–å†™HelloWorldç¨‹åº

- ç¬¬ä¸€æ­¥ï¼Œåœ¨å·¥ç¨‹çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºconfigç›®å½•ï¼Œåœ¨configç›®å½•ä¸‹åˆ›å»ºconfig.jsæ–‡ä»¶ã€‚

> åœ¨UmiJSçš„çº¦å®šä¸­ï¼Œconfig/config.jså°†ä½œä¸ºUmiJSçš„å…¨å±€é…ç½®æ–‡ä»¶ã€‚
>
> ![UmiJSçš„å…¨å±€é…ç½®æ–‡ä»¶](images/20190421222234633_8339.png)  
>
> åœ¨ umiä¸­ï¼Œçº¦å®šçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
>
> ![umiçº¦å®šçš„ç›®å½•ç»“æ„](images/20190421222138258_25794.png)

åœ¨config.jsæ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹å†…å­˜ï¼Œä»¥ä¾¿åé¢ä½¿ç”¨

```js
// å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œæš‚æ—¶è®¾ç½®ä¸ºç©ºå¯¹è±¡ï¼Œåé¢å†å¡«å……å†…å®¹
export default {};
```

- ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºHelloWorld.jsé¡µé¢æ–‡ä»¶

åœ¨umiä¸­ï¼Œçº¦å®šå­˜æ”¾é¡µé¢ä»£ç çš„æ–‡ä»¶å¤¹æ˜¯åœ¨src/pagesï¼Œå¯ä»¥é€šè¿‡`singular:false`æ¥è®¾ç½®å•æ•°çš„å‘½åæ–¹å¼ï¼Œä¸€èˆ¬é‡‡ç”¨é»˜è®¤å³å¯ã€‚

åœ¨HelloWorld.jsæ–‡ä»¶ä¸­è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š

```jsx
export default () => {
    return <div> hello world </div>;
}
```

**æ³¨ï¼šä¸Šé¢çš„jsæ–‡ä»¶æ˜¯reactè‡ªåˆ›çš„å†™æ³•ï¼Œå«JSX**

- ç¬¬ä¸‰æ­¥ï¼Œå¯åŠ¨æœåŠ¡æŸ¥çœ‹é¡µé¢æ•ˆæœ

```shell
# å¯åŠ¨æœåŠ¡
umi dev
```

å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡`/HelloWorld`è·¯å¾„å³å¯è®¿é—®åˆ°åˆšåˆšå†™çš„HelloWorld.jsæ–‡ä»¶ã€‚

åœ¨umiä¸­ï¼Œå¯ä»¥ä½¿ç”¨çº¦å®šå¼çš„è·¯ç”±ï¼Œåœ¨pagesä¸‹é¢çš„JSæ–‡ä»¶éƒ½ä¼šæŒ‰ç…§æ–‡ä»¶åæ˜ å°„åˆ°ä¸€ä¸ªè·¯ç”±ï¼Œæ¯”å¦‚ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œè®¿é—® `/helloworld` ä¼šå¯¹åº”åˆ° HelloWorld.jsã€‚å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰è·¯ç”±

### 3.3. æ·»åŠ umi-plugin-reactæ’ä»¶

umi-plugin-reactæ’ä»¶æ˜¯umiå®˜æ–¹åŸºäºreactå°è£…çš„æ’ä»¶ï¼ŒåŒ…å«äº†13ä¸ªå¸¸ç”¨çš„è¿›é˜¶åŠŸèƒ½ã€‚

å…·ä½“å¯æŸ¥çœ‹ï¼šhttps://umijs.org/zh/plugin/umi-plugin-react.html

- åœ¨å½“å‰å·¥ç¨‹ç›®å½•ä¸‹ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ·»åŠ è¯¥æ’ä»¶ä¾èµ–ã€‚æˆåŠŸåä¼šåœ¨package.jsonæ–‡ä»¶çš„`dependencies`å±æ€§ä¸­å¢åŠ `"umi-plugin-react": "^1.7.4"`

```shell
# æ·»åŠ æ’ä»¶
npm add umi-plugin-react --dev
```

![æ·»åŠ ä¾èµ–](images/20190421231339746_24673.png)

- ä¿®æ”¹config.jsæ–‡ä»¶ï¼Œå¼•å…¥è¯¥æ’ä»¶ï¼š

```js
export default {
    plugins: [
        ['umi-plugin-react', {
            //æš‚æ—¶ä¸å¯ç”¨ä»»ä½•åŠŸèƒ½
        }]
    ]
};
```

### 3.4. æ„å»ºå’Œéƒ¨ç½²

- é€šè¿‡umiæ˜¯å¯ä»¥è¿›è¡Œè½¬ç ç”Ÿæˆæ–‡ä»¶çš„

```shell
# å·¥ç¨‹çš„ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤
umi build
```

- è¿è¡Œå‘½ä»¤åï¼Œä¼šåœ¨dishæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆ*index.htmlå’Œumi.js*æ–‡ä»¶ã€‚umi.jsæ–‡ä»¶æ˜¯ä¸€ä¸ªå·²ç»å‹ç¼©è¿‡çš„æ–‡ä»¶ï¼Œä¹‹å‰å†™çš„ä»£ç éƒ½å·²ç»è¢«è½¬ç åˆ°æ­¤æ–‡ä»¶ä¸­ã€‚è¿™äº›æ–‡ä»¶å°±æ˜¯ç”¨äºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­

## 4. JSX è¯­æ³•

- JSXè¯­æ³•å°±æ˜¯ï¼Œå¯ä»¥åœ¨jsæ–‡ä»¶ä¸­æ’å…¥htmlç‰‡æ®µï¼Œæ˜¯Reactè‡ªåˆ›çš„ä¸€ç§è¯­æ³•ã€‚
- JSXè¯­æ³•ä¼šè¢«Babelç­‰è½¬ç å·¥å…·è¿›è¡Œè½¬ç ï¼Œå¾—åˆ°æ­£å¸¸çš„jsä»£ç å†æ‰§è¡Œã€‚
- ä½¿ç”¨JSXè¯­æ³•ï¼Œéœ€è¦2ç‚¹æ³¨æ„ï¼š
    1. æ‰€æœ‰çš„htmlæ ‡ç­¾å¿…é¡»æ˜¯é—­åˆçš„ï¼Œå¦‚ï¼š`<div>HelloWorld</div>`çš„å†™æ³•æ˜¯æ­£ç¡®ï¼›`<div>HelloWorld`çš„å†™æ³•æ˜¯é”™è¯¯çš„ï¼›
    2. åœ¨JSXè¯­æ³•ä¸­ï¼Œåªèƒ½æœ‰ä¸€ä¸ªæ ¹æ ‡ç­¾ï¼Œä¸èƒ½æœ‰å¤šä¸ªã€‚

    ```jsx
    const div1 = <div>hello world</div> // æ­£ç¡®
    const div2 = <div>hello</div> <div>world</div> // é”™è¯¯
    ```

### 4.1. JavaScript è¡¨è¾¾å¼

åœ¨JSXè¯­æ³•ä¸­ï¼Œå¦‚æœæƒ³è¦åœ¨htmlæ ‡ç­¾ä¸­æ’å…¥jsè„šæœ¬ï¼Œéœ€è¦é€šè¿‡`{}`æ’å…¥jsè„šæœ¬ã€‚

![htmlæ ‡ç­¾ä¸­å¼•å…¥js](images/20190421225348968_32483.png)

### 4.2. JSX ä¸­çš„ CSS å’Œ å¯¹è±¡

React ä¸è¦æ±‚å¿…é¡»ä½¿ç”¨å†…è”æ ·å¼ï¼ˆä½¿ç”¨ CSS ç±»å°±èƒ½æ»¡è¶³å¤§éƒ¨åˆ†æƒ…å†µï¼‰ã€‚å½“éœ€è¦å†…è”æ ·å¼çš„æ—¶å€™ï¼Œå¯ä»¥ç»™ `style` å±æ€§ä¼ é€’ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚ä¸‹

å¯ä»¥ä½¿ç”¨ camelCase è¯­æ³•æ¥è®¾ç½®å†…è”æ ·å¼ã€‚ React ä¼šåœ¨æŒ‡å®šå…ƒç´ æ•°å­—åè‡ªåŠ¨æ·»åŠ  pxã€‚

```jsx
const myStyle = {
    fontSize : 100,
    color : "#FF0000"
};
ReactDOM.render(
    <h1 style = {myStyle}>æœˆã®å“€å‚·</h1>,
    document.getElementById('example')
);
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š<font color=red>**å†…è” `style` å±æ€§éœ€è¦ä½¿ç”¨é©¼å³°å‘½åæ³•ç¼–å†™**</font>ã€‚ä¾‹å¦‚ï¼ŒHTML `<ul style="background-color: black">` åœ¨ç»„ä»¶é‡Œåº”è¯¥å†™æˆ `<ul style={{ backgroundColor: 'black' }}>`ã€‚

é™¤äº†å­—ç¬¦ä¸²ã€æ•°å­—å’Œå…¶å®ƒ JavaScript è¡¨è¾¾å¼ï¼Œè¿˜å¯ä»¥åœ¨ JSX ä¸­ä¼ é€’å¯¹è±¡ã€‚ç”±äºå¯¹è±¡ä¹Ÿç”¨å¤§æ‹¬å·è¡¨ç¤ºï¼Œä¾‹å¦‚ `{ name: "MooN", inventions: 5 }`ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½åœ¨ JSX ä¸­ä¼ é€’ï¼Œå¿…é¡»ç”¨å¦ä¸€å¯¹é¢å¤–çš„å¤§æ‹¬å·åŒ…è£¹å¯¹è±¡ï¼š`person={{ name: "MooN", inventions: 5 }}`ã€‚

### 4.3. æ³¨é‡Š

æ³¨é‡Šéœ€è¦å†™åœ¨èŠ±æ‹¬å·ä¸­

```jsx
ReactDOM.render(
    <div>
        <h1>æœˆã®å“€å‚·</h1>
        {/*æ³¨é‡Š...*/}
    </div>,
    document.getElementById('example')
);
```

### 4.4. æ•°ç»„

JSX å…è®¸åœ¨æ¨¡æ¿ä¸­æ’å…¥æ•°ç»„ï¼Œæ•°ç»„ä¼šè‡ªåŠ¨å±•å¼€æ‰€æœ‰æˆå‘˜

```jsx
var arr = [
    <h1>æœˆã®å“€å‚·</h1>,
    <h2>Hello MooNkirAï¼</h2>,
];
ReactDOM.render(
    <div>{arr}</div>,
    document.getElementById('example')
);
```

### 4.5. HTML æ ‡ç­¾ä¸ React ç»„ä»¶

- React å¯ä»¥æ¸²æŸ“ HTML æ ‡ç­¾ (strings) æˆ– React ç»„ä»¶ (classes)ã€‚è¦æ¸²æŸ“ HTML æ ‡ç­¾ï¼Œåªéœ€åœ¨ JSX é‡Œä½¿ç”¨å°å†™å­—æ¯çš„æ ‡ç­¾åã€‚

```jsx
var myDivElement = <div className="foo" />;
ReactDOM.render(myDivElement, document.getElementById('example'));
```

- è¦æ¸²æŸ“ React ç»„ä»¶ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªå¤§å†™å­—æ¯å¼€å¤´çš„æœ¬åœ°å˜é‡ã€‚

```jsx
var MyComponent = React.createClass({/*...*/});
var myElement = <MyComponent someProperty={true} />;
ReactDOM.render(myElement, document.getElementById('example'));
```

- React çš„ JSX ä½¿ç”¨å¤§ã€å°å†™çš„çº¦å®šæ¥åŒºåˆ†æœ¬åœ°ç»„ä»¶çš„ç±»å’Œ HTML æ ‡ç­¾ã€‚

> **æ³¨æ„ï¼šç”±äº JSX å°±æ˜¯ JavaScriptï¼Œä¸€äº›æ ‡è¯†ç¬¦åƒ class å’Œ for ä¸å»ºè®®ä½œä¸º XML å±æ€§åã€‚ä½œä¸ºæ›¿ä»£ï¼ŒReact DOM ä½¿ç”¨ className å’Œ htmlFor æ¥åšå¯¹åº”çš„å±æ€§ã€‚**

## 5. ç»„ä»¶

ç»„ä»¶æ˜¯ React ä¸­æœ€é‡è¦ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„æ¦‚å¿µï¼Œä¸€ä¸ªç½‘é¡µï¼Œå¯ä»¥è¢«æ‹†åˆ†æˆä¸€ä¸ªä¸ªçš„ç»„ä»¶ã€‚åœ¨ React ä¸­ï¼Œè¿™æ ·å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼š

```jsx
import React from 'react'; // ç¬¬ä¸€æ­¥ï¼Œå¯¼å…¥React
class HelloWorld extends React.Component { // ç¬¬äºŒæ­¥ï¼Œç¼–å†™ç±»å¹¶ä¸”ç»§æ‰¿ React.Component
    render() { // ç¬¬ä¸‰æ­¥ï¼Œé‡å†™render()æ–¹æ³•ï¼Œç”¨äºæ¸²æŸ“é¡µé¢
        return <div>hello world!</div> // JSXè¯­æ³•
    }
}
export default HelloWorld; // ç¬¬å››æ­¥ï¼Œå¯¼å‡ºè¯¥ç±»
```

***æ³¨ï¼šé¡µé¢çš„æ ‡ç­¾æ˜¯å®šä¹‰åœ¨renderä¸­çš„returnï¼Œå¦‚æœæ˜¯æ ‡ç­¾æ˜¯å¤šè¡Œï¼Œåˆ™éœ€è¦ä½¿ç”¨â€œ()â€è¿›è¡ŒåŒ…è£¹***

### 5.1. å¯¼å…¥è‡ªå®šä¹‰ç»„ä»¶

åˆ›å»ºShow.jsæ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•å¯¼å…¥ç»„ä»¶

```jsx
import React from 'react'
import HelloWorld from './HelloWorld' // å¯¼å…¥HelloWorldç»„ä»¶
class Show extends React.Component {
    render() {
        return <HelloWorld />; // ä½¿ç”¨HelloWorldç»„ä»¶
    }
}
export default Show;
```

### 5.2. ç»„ä»¶å‚æ•°
#### 5.2.1. å®šä¹‰ä¼ é€’å‚æ•°

ç»„ä»¶æ˜¯å¯ä»¥ä¼ é€’å‚æ•°çš„ï¼Œæœ‰2ç§æ–¹å¼ä¼ é€’ï¼Œåˆ†åˆ«æ˜¯**å±æ€§**å’Œ**æ ‡ç­¾åŒ…è£¹çš„å†…å®¹**ä¼ é€’

å¦‚ä¸‹ä¾‹å­ï¼Œå¼•å…¥ç»„ä»¶HelloWorldï¼Œå®šä¹‰name="zhangsan"å°±æ˜¯å±æ€§ä¼ é€’ï¼Œshanghaiå°±æ˜¯æ ‡ç­¾åŒ…è£¹çš„å†…å®¹ä¼ é€’ã€‚

```jsx
import React from 'react'
import HelloWorld from './HelloWorld' // å¯¼å…¥HelloWorldç»„ä»¶
class Show extends React.Component {
    render() {
        return <HelloWorld name="zhangsan">shanghai</HelloWorld>; // ä½¿ç”¨HelloWorldç»„ä»¶
    }
}
export default Show;
```

#### 5.2.2. æ¥æ”¶å‚æ•°

æ¥æ”¶å‚æ•°ä¹Ÿæ˜¯2ç§æ–¹æ³•ï¼š

- **å±æ€§**ï¼š**`this.props.name`**æ¥æ”¶ï¼›
- **æ ‡ç­¾å†…å®¹**ï¼š**`this.props.children`**æ¥æ”¶ï¼›

```jsx
import React from 'react';
class HelloWorld extends React.Component {
    render() {
        // å±æ€§ï¼šthis.props.name æ¥æ”¶ï¼›
        // æ ‡ç­¾å†…å®¹ï¼šthis.props.children æ¥æ”¶ï¼›
        return <div>hello world! name={this.props.name}, address={this.props.children}</div>
    }
}
export default HelloWorld;
```

### 5.3. ç»„ä»¶çš„çŠ¶æ€

**æ¯ä¸€ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªçŠ¶æ€ï¼Œå…¶ä¿å­˜åœ¨this.stateä¸­ï¼Œå½“çŠ¶æ€å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReactæ¡†æ¶ä¼šè‡ªåŠ¨è°ƒç”¨render()æ–¹æ³•ï¼Œé‡æ–°æ¸²æŸ“é¡µé¢ã€‚**

å…¶ä¸­ï¼Œè¦æ³¨æ„ä¸¤ç‚¹ï¼š

- **ä¸€ï¼šthis.stateå€¼çš„è®¾ç½®è¦åœ¨æ„é€ å‚æ•°ä¸­å®Œæˆï¼›**
- **äºŒï¼šè¦ä¿®æ”¹this.stateçš„å€¼ï¼Œéœ€è¦è°ƒç”¨this.setState()å®Œæˆï¼Œä¸èƒ½ç›´æ¥å¯¹this.stateè¿›è¡Œä¿®æ”¹**

æ¡ˆä¾‹è¯´æ˜ï¼šé€šè¿‡ç‚¹å‡»æŒ‰é’®ï¼Œä¸æ–­çš„æ›´æ–°this.stateï¼Œä»è€Œååº”åˆ°é¡µé¢ä¸­ã€‚

```jsx
import React from 'react'
class List extends React.Component {
    constructor(props) { // æ„é€ å‚æ•°ä¸­å¿…é¡»è¦propså‚æ•°
        super(props); // è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•
        this.state = { // åˆå§‹åŒ–this.state
            dataList: [1, 2, 3],
            maxNum: 3
        };
    }
    render() {
        return (
            <div>
                <ul>
                    {
                        // éå†å€¼
                        this.state.dataList.map((value, index) => {
                            return <li key={index}>{value}</li>
                        })
                    }
                </ul>
                <button
                    onClick={() => { // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        let maxNum = this.state.maxNum + 1;
                        let list = [...this.state.dataList, maxNum];
                        this.setState({ // æ›´æ–°çŠ¶æ€å€¼
                            dataList: list,
                            maxNum: maxNum
                        });
                    }}>
                    æ·»åŠ 
                </button>
            </div>
        );
    }
}
export default List;
```

- åˆå§‹çŠ¶æ€ï¼š

![ç»„ä»¶çŠ¶æ€æ¡ˆä¾‹1](images/20190422133348742_13130.png)

- å½“ç‚¹å‡» â€œæ·»åŠ â€æŒ‰é’®ï¼š

![ç»„ä»¶çŠ¶æ€æ¡ˆä¾‹2](images/20190422133353030_13644.png)

- è¿‡ç¨‹åˆ†æ

![ç»„ä»¶çŠ¶æ€æ¡ˆä¾‹3](images/20190422133358551_22006.png)

### 5.4. React ç»„ä»¶ API

- è®¾ç½®çŠ¶æ€ï¼šsetState
- æ›¿æ¢çŠ¶æ€ï¼šreplaceState
- è®¾ç½®å±æ€§ï¼šsetProps
- æ›¿æ¢å±æ€§ï¼šreplaceProps
- å¼ºåˆ¶æ›´æ–°ï¼šforceUpdate
- è·å–DOMèŠ‚ç‚¹ï¼šfindDOMNode
- åˆ¤æ–­ç»„ä»¶æŒ‚è½½çŠ¶æ€ï¼šisMounted

#### 5.4.1. è®¾ç½®çŠ¶æ€ï¼šsetState

```js
setState(object nextState[, function callback])
```

- å‚æ•°è¯´æ˜
    - `nextState`ï¼Œå°†è¦è®¾ç½®çš„æ–°çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¼šå’Œå½“å‰çš„stateåˆå¹¶
    - `callback`ï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨`setState`è®¾ç½®æˆåŠŸï¼Œä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åè°ƒç”¨ã€‚
- åˆå¹¶`nextState`å’Œå½“å‰`state`ï¼Œå¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚`setState`æ˜¯Reactäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å’Œè¯·æ±‚å›è°ƒå‡½æ•°ä¸­è§¦å‘UIæ›´æ–°çš„ä¸»è¦æ–¹æ³•ã€‚
- å…³äºsetState
    - ä¸èƒ½åœ¨ç»„ä»¶å†…éƒ¨é€šè¿‡`this.state`ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºè¯¥çŠ¶æ€ä¼šåœ¨è°ƒç”¨`setState()`åè¢«æ›¿æ¢ã€‚
    - `setState()`å¹¶ä¸ä¼šç«‹å³æ”¹å˜this.stateï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªå³å°†å¤„ç†çš„stateã€‚`setState()`å¹¶ä¸ä¸€å®šæ˜¯åŒæ­¥çš„ï¼Œä¸ºäº†æå‡æ€§èƒ½Reactä¼šæ‰¹é‡æ‰§è¡Œstateå’ŒDOMæ¸²æŸ“ã€‚
    - `setState()`æ€»æ˜¯ä¼šè§¦å‘ä¸€æ¬¡ç»„ä»¶é‡ç»˜ï¼Œé™¤éåœ¨`shouldComponentUpdate()`ä¸­å®ç°äº†ä¸€äº›æ¡ä»¶æ¸²æŸ“é€»è¾‘ã€‚

```jsx
var Counter = React.createClass({
  getInitialState: function () {
    return { clickCount: 0 };
  },
  handleClick: function () {
    this.setState(function(state) {
      return {clickCount: state.clickCount + 1};
    });
  },
  render: function () {
    return (<h2 onClick={this.handleClick}>ç‚¹æˆ‘ï¼ç‚¹å‡»æ¬¡æ•°ä¸º: {this.state.clickCount}</h2>);
  }
});
ReactDOM.render(
  <Counter />,
  document.getElementById('message')
);
```

#### 5.4.2. æ›¿æ¢çŠ¶æ€ï¼šreplaceState

```js
replaceState(object nextState[, function callback])
```

- nextStateï¼Œå°†è¦è®¾ç½®çš„æ–°çŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¼šæ›¿æ¢å½“å‰çš„stateã€‚
- callbackï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨replaceStateè®¾ç½®æˆåŠŸï¼Œä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åè°ƒç”¨ã€‚

`replaceState()`æ–¹æ³•ä¸`setState()`ç±»ä¼¼ï¼Œä½†æ˜¯æ–¹æ³•åªä¼šä¿ç•™nextStateä¸­çŠ¶æ€ï¼ŒåŸstateä¸åœ¨nextStateä¸­çš„çŠ¶æ€éƒ½ä¼šè¢«åˆ é™¤

#### 5.4.3. è®¾ç½®å±æ€§ï¼šsetProps

```js
setProps(object nextProps[, function callback])
```

- nextPropsï¼Œå°†è¦è®¾ç½®çš„æ–°å±æ€§ï¼Œè¯¥çŠ¶æ€ä¼šå’Œå½“å‰çš„propsåˆå¹¶
- callbackï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨setPropsè®¾ç½®æˆåŠŸï¼Œä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åè°ƒç”¨ã€‚

è®¾ç½®ç»„ä»¶å±æ€§ï¼Œå¹¶é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

propsç›¸å½“äºç»„ä»¶çš„æ•°æ®æµï¼Œå®ƒæ€»æ˜¯ä¼šä»çˆ¶ç»„ä»¶å‘ä¸‹ä¼ é€’è‡³æ‰€æœ‰çš„å­ç»„ä»¶ä¸­ã€‚å½“å’Œä¸€ä¸ªå¤–éƒ¨çš„JavaScriptåº”ç”¨é›†æˆæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šéœ€è¦å‘ç»„ä»¶ä¼ é€’æ•°æ®æˆ–é€šçŸ¥`React.render()`ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨`setProps()`ã€‚

æ›´æ–°ç»„ä»¶ï¼Œæˆ‘å¯ä»¥åœ¨èŠ‚ç‚¹ä¸Šå†æ¬¡è°ƒç”¨`React.render()`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`setProps()`æ–¹æ³•æ”¹å˜ç»„ä»¶å±æ€§ï¼Œè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

#### 5.4.4. æ›¿æ¢å±æ€§ï¼šreplaceProps

```js
replaceProps(object nextProps[, function callback])
```

- nextPropsï¼Œå°†è¦è®¾ç½®çš„æ–°å±æ€§ï¼Œè¯¥å±æ€§ä¼šæ›¿æ¢å½“å‰çš„propsã€‚
- callbackï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨replacePropsè®¾ç½®æˆåŠŸï¼Œä¸”ç»„ä»¶é‡æ–°æ¸²æŸ“åè°ƒç”¨ã€‚

`replaceProps()`æ–¹æ³•ä¸`setProps`ç±»ä¼¼ï¼Œä½†å®ƒä¼šåˆ é™¤åŸæœ‰props

#### 5.4.5. å¼ºåˆ¶æ›´æ–°ï¼šforceUpdate

```js
forceUpdate([function callback])
```

- callbackï¼Œå¯é€‰å‚æ•°ï¼Œå›è°ƒå‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨ç»„ä»¶`render()`æ–¹æ³•è°ƒç”¨åè°ƒç”¨ã€‚

`forceUpdate()`æ–¹æ³•ä¼šä½¿ç»„ä»¶è°ƒç”¨è‡ªèº«çš„`render()`æ–¹æ³•é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œç»„ä»¶çš„å­ç»„ä»¶ä¹Ÿä¼šè°ƒç”¨è‡ªå·±çš„`render()`ã€‚ä½†æ˜¯ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¾ç„¶ä¼šè¯»å–`this.props`å’Œ`this.state`ï¼Œå¦‚æœçŠ¶æ€æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆReactåªä¼šæ›´æ–°DOMã€‚

`forceUpdate()`æ–¹æ³•é€‚ç”¨äº`this.props`å’Œ`this.state`ä¹‹å¤–çš„ç»„ä»¶é‡ç»˜ï¼ˆå¦‚ï¼šä¿®æ”¹äº†`this.state`åï¼‰ï¼Œé€šè¿‡è¯¥æ–¹æ³•é€šçŸ¥Reactéœ€è¦è°ƒç”¨`render()`

ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨`forceUpdate()`ï¼Œè€Œä»…ä»`this.props`å’Œ`this.state`ä¸­è¯»å–çŠ¶æ€å¹¶ç”±Reactè§¦å‘`render()`è°ƒç”¨ã€‚

#### 5.4.6. è·å–DOMèŠ‚ç‚¹ï¼šfindDOMNode

```js
DOMElement findDOMNode()
```

- è¿”å›å€¼ï¼šDOMå…ƒç´ DOMElement

å¦‚æœç»„ä»¶å·²ç»æŒ‚è½½åˆ° DOM ä¸­ï¼Œè¯¥æ–¹æ³•è¿”å›å¯¹åº”çš„æœ¬åœ°æµè§ˆå™¨ DOM å…ƒç´ ã€‚å½“renderè¿”å› null æˆ– false æ—¶ï¼Œ`this.findDOMNode()`ä¹Ÿä¼šè¿”å›nullã€‚ä» DOM ä¸­è¯»å–å€¼çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å¾ˆæœ‰ç”¨ï¼Œå¦‚ï¼šè·å–è¡¨å•å­—æ®µçš„å€¼å’Œåšä¸€äº› DOM æ“ä½œã€‚

#### 5.4.7. åˆ¤æ–­ç»„ä»¶æŒ‚è½½çŠ¶æ€ï¼šisMounted

```js
boolean isMounted()
```

- è¿”å›å€¼ï¼štrueæˆ–falseï¼Œè¡¨ç¤ºç»„ä»¶æ˜¯å¦å·²æŒ‚è½½åˆ°DOMä¸­

`isMounted()`æ–¹æ³•ç”¨äºåˆ¤æ–­ç»„ä»¶æ˜¯å¦å·²æŒ‚è½½åˆ°DOMä¸­ã€‚å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ä¿è¯äº†`setState()`å’Œ`forceUpdate()`åœ¨å¼‚æ­¥åœºæ™¯ä¸‹çš„è°ƒç”¨ä¸ä¼šå‡ºé”™ã€‚

### 5.5. ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

ç»„ä»¶çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸åŒçš„é˜¶æ®µã€‚React ä¸ºè¿™äº›é˜¶æ®µæä¾›äº†é’©å­æ–¹æ³•ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰æ¯ä¸ªé˜¶æ®µè‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ã€‚è¿™äº›æ–¹æ³•ç»Ÿç§°ä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆlifecycle methodsï¼‰ã€‚

- ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯åˆ†æˆä¸‰ä¸ªçŠ¶æ€ï¼š
    - **Mounting**ï¼šå·²æ’å…¥çœŸå® DOM
    - **Updating**ï¼šæ­£åœ¨è¢«é‡æ–°æ¸²æŸ“
    - **Unmounting**ï¼šå·²ç§»å‡ºçœŸå® DOM
- ç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•æœ‰ï¼š
    - **componentWillMount**ï¼šåœ¨æ¸²æŸ“å‰è°ƒç”¨,åœ¨å®¢æˆ·ç«¯ä¹Ÿåœ¨æœåŠ¡ç«¯ã€‚
    - **componentDidMount**ï¼šåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åè°ƒç”¨ï¼Œåªåœ¨å®¢æˆ·ç«¯ã€‚ä¹‹åç»„ä»¶å·²ç»ç”Ÿæˆäº†å¯¹åº”çš„DOMç»“æ„ï¼Œå¯ä»¥é€šè¿‡`this.getDOMNode()`æ¥è¿›è¡Œè®¿é—®ã€‚ å¦‚æœä½ æƒ³å’Œå…¶ä»–JavaScriptæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨setTimeout, setIntervalæˆ–è€…å‘é€AJAXè¯·æ±‚ç­‰æ“ä½œ(é˜²æ­¢å¼‚éƒ¨æ“ä½œé˜»å¡UI)ã€‚
    - **componentWillReceiveProps**ï¼šåœ¨ç»„ä»¶æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„propæ—¶è¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•åœ¨åˆå§‹åŒ–renderæ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚
    - **shouldComponentUpdate**ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚åœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„propsæˆ–è€…stateæ—¶è¢«è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶æˆ–è€…ä½¿ç”¨forceUpdateæ—¶ä¸è¢«è°ƒç”¨ã€‚å¯ä»¥åœ¨ä½ ç¡®è®¤ä¸éœ€è¦æ›´æ–°ç»„ä»¶æ—¶ä½¿ç”¨ã€‚
    - **componentWillUpdate**ï¼šåœ¨ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„propsæˆ–è€…stateä½†è¿˜æ²¡æœ‰renderæ—¶è¢«è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚
    - **componentDidUpdate**ï¼šåœ¨ç»„ä»¶å®Œæˆæ›´æ–°åç«‹å³è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚
    - **componentWillUnmount**ï¼šåœ¨ç»„ä»¶ä» DOM ä¸­ç§»é™¤çš„æ—¶å€™ç«‹åˆ»è¢«è°ƒç”¨ã€‚

#### 5.5.1. ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå›¾

![ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå›¾](images/20190422133625324_6357.png)

#### 5.5.2. ç”Ÿå‘½å‘¨æœŸç¤ºä¾‹

```jsx
import React from 'react'; // å¯¼å…¥React
class LifeCycle extends React.Component {
    constructor(props) {
        super(props);
        // æ„é€ æ–¹æ³•;
        console.log("constructor()");
    }
    componentDidMount() {
        // ç»„ä»¶æŒ‚è½½åè°ƒç”¨
        console.log("componentDidMount()");
    }
    componentWillUnmount() {
        // åœ¨ç»„ä»¶ä» DOM ä¸­ç§»é™¤ä¹‹å‰ç«‹åˆ»è¢«è°ƒç”¨ã€‚
        console.log("componentWillUnmount()");
    }
    componentDidUpdate() {
        // åœ¨ç»„ä»¶å®Œæˆæ›´æ–°åç«‹å³è°ƒç”¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ä¸ä¼šè¢«è°ƒç”¨ã€‚
        console.log("componentDidUpdate()");
    }
    shouldComponentUpdate(nextProps, nextState) {
        // æ¯å½“this.propsæˆ–this.stateæœ‰å˜åŒ–ï¼Œåœ¨renderæ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚
        // è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦åº”è¯¥ç»§ç»­æ‰§è¡Œrenderæ–¹æ³•ï¼Œå³å¦‚æœè¿”å›falseï¼ŒUI å°±ä¸ä¼šæ›´æ–°ï¼Œé»˜è®¤è¿”å›trueã€‚
        // ç»„ä»¶æŒ‚è½½æ—¶ï¼Œrenderæ–¹æ³•çš„ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¸ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚
        console.log("shouldComponentUpdate()");
    }
    render() {
        return (
            <div>
                <h1>React Life Cycle!</h1>
            </div>
        );
    }
}
export default LifeCycle;
```

### 5.6. React ä¸­ Component å’Œ PureComponent æ¯”è¾ƒ

React 15.3 ä¸­æ–°åŠ äº†ä¸€ä¸ª `PureComponent` ç±»ï¼Œé¡¾åæ€ä¹‰ï¼Œ pure æ˜¯çº¯çš„æ„æ€ï¼Œ `PureComponent` ä¹Ÿå°±æ˜¯çº¯ç»„ä»¶ï¼Œå–ä»£å…¶å‰èº« `PureRenderMixin`, `PureComponent` æ˜¯ä¼˜åŒ– React åº”ç”¨ç¨‹åºæœ€é‡è¦çš„æ–¹æ³•ä¹‹ä¸€ï¼Œæ˜“äºå®æ–½ï¼Œåªè¦æŠŠç»§æ‰¿ç±»ä» Component æ¢æˆ PureComponent å³å¯ï¼Œå¯ä»¥å‡å°‘ä¸å¿…è¦çš„ render æ“ä½œçš„æ¬¡æ•°ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼Œè€Œä¸”å¯ä»¥å°‘å†™ `shouldComponentUpdate` å‡½æ•°ï¼ŒèŠ‚çœäº†ç‚¹ä»£ç ã€‚

```js
import React, { PureComponent } from 'react';
class App extends PureComponent {}
```

```js
import React, { Component } from 'react';
class App extends Component {}
```

Componentæ˜¯React Appçš„åŸºæœ¬æ„å»ºçš„å•ä½ï¼Œä¹Ÿæ˜¯Reactä¸­çš„åŸºæœ¬ä»£ç å¤ç”¨å•ä½ã€‚PureComponentä¸Componentåœ¨é™¤äº†å…¶shouldComponentUpdateæ–¹æ³•çš„å®ç°ä¹‹å¤–å‡ ä¹å®Œå…¨ç›¸åŒã€‚PureComponentå·²ç»æ›¿æˆ‘ä»¬å®ç°äº†shouldComponentUpdateæ–¹æ³•ã€‚

å¯¹äºPureComponentè€Œè¨€ï¼Œå½“å…¶propsæˆ–è€…stateæ”¹å˜ä¹‹æ—¶ï¼Œæ–°æ—§propsä¸stateå°†è¿›è¡Œæµ…å¯¹æ¯”ï¼ˆshallow comparisonï¼‰ã€‚å¦ä¸€æ–¹é¢ï¼ŒComponenté»˜è®¤çš„æƒ…å†µä¸‹å…¶shouldComponentUpdateæ–¹æ³•å¹¶ä¸è¿›è¡Œæ–°æ—§propsä¸stateçš„å¯¹æ¯”ã€‚

å› æ­¤æ„å‘³ç€ç›¸æ¯”äºComponentï¼ŒPureCompoentçš„æ€§èƒ½è¡¨ç°å°†ä¼šæ›´å¥½ã€‚ä½†**ä½¿ç”¨PureCompoentè¦æ±‚æ»¡è¶³å¦‚ä¸‹æ¡ä»¶**ï¼š

1. propså’Œstateéƒ½å¿…é¡»æ˜¯ä¸å¯å˜å¯¹è±¡ï¼ˆimmutable objectï¼‰ã€‚
2. propså’Œstateä¸èƒ½æœ‰å±‚çº§åµŒå¥—çš„ç»“æ„ï¼Œï¼ˆå¦åˆ™å¯¹å­å±‚çº§çš„æ”¹å˜æ— æ³•åæ˜ åœ¨æµ…æ‹·è´ä¸­ï¼‰ã€‚
3. å¦‚æœæ•°æ®æ”¹å˜æ— æ³•ååº”åœ¨æµ…æ‹·è´ä¸Šï¼Œåˆ™åº”è¯¥è°ƒç”¨forceUpdateæ¥æ›´æ–°Componentã€‚
4. ä¸€ä¸ªPureComponentçš„å­Componentä¹Ÿåº”å½“æ˜¯PureComponentã€‚

### 5.7. åµŒå¥—å’Œç»„ç»‡ç»„ä»¶

#### 5.7.1. æ¦‚è¿°

ç»„ä»¶æ˜¯å¸¸è§„çš„ JavaScript å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥å°†å¤šä¸ªç»„ä»¶ä¿å­˜åœ¨åŒä¸€ä»½æ–‡ä»¶ä¸­ã€‚å½“ç»„ä»¶ç›¸å¯¹è¾ƒå°æˆ–å½¼æ­¤ç´§å¯†ç›¸å…³æ—¶ï¼Œè¿™æ˜¯ä¸€ç§çœäº‹çš„å¤„ç†æ–¹å¼ã€‚éšç€è¿™ä¸ªæ–‡ä»¶å˜å¾—è‡ƒè‚¿ï¼Œä¹Ÿå¯ä»¥éšæ—¶å°†é‡Œé¢éƒ¨åˆ†ç»„ä»¶ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ã€‚

#### 5.7.2. åµŒå¥—é™·é˜±

ç»„ä»¶å¯ä»¥æ¸²æŸ“å…¶ä»–ç»„ä»¶ï¼Œä½†æ˜¯**ä¸è¦åµŒå¥—ä»–ä»¬çš„å®šä¹‰**ã€‚ä¾‹å¦‚ï¼š

```jsx
export default function Gallery() {
  // ğŸ”´ æ°¸è¿œä¸è¦åœ¨ç»„ä»¶ä¸­å®šä¹‰ç»„ä»¶
  function Profile() {
    // ...
  }
  // ...
}
```

ä¸Šé¢è¿™æ®µä»£ç **éå¸¸æ…¢ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´ bug äº§ç”Ÿ**ã€‚å› æ­¤åº”è¯¥åœ¨é¡¶å±‚å®šä¹‰æ¯ä¸ªç»„ä»¶ï¼š

```jsx
export default function Gallery() {
  // ...
}

// âœ… åœ¨é¡¶å±‚å£°æ˜ç»„ä»¶
function Profile() {
  // ...
}
```

å»ºè®®å½“å­ç»„ä»¶éœ€è¦ä½¿ç”¨çˆ¶ç»„ä»¶çš„æ•°æ®æ—¶ï¼Œå¯ä»¥é€šè¿‡ props çš„å½¢å¼è¿›è¡Œä¼ é€’ï¼Œè€Œä¸æ˜¯åµŒå¥—å®šä¹‰ã€‚

### 5.8. ç»„ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º

é€šå¸¸ï¼Œæ–‡ä»¶ä¸­ä»…åŒ…å«ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œä¸€èˆ¬ä¼šé€‰æ‹©é»˜è®¤å¯¼å‡ºï¼›è€Œå½“æ–‡ä»¶ä¸­åŒ…å«å¤šä¸ªç»„ä»¶æˆ–æŸä¸ªå€¼éœ€è¦å¯¼å‡ºæ—¶ï¼Œåˆ™ä¼šé€‰æ‹©å…·åå¯¼å‡ºã€‚æ— è®ºé€‰æ‹©å“ªç§æ–¹å¼ï¼Œå»ºè®®ç»™ç»„ä»¶å’Œç›¸åº”çš„æ–‡ä»¶ä¸€ä¸ªæœ‰æ„ä¹‰çš„å‘½åï¼Œä¸å»ºè®®åˆ›å»ºæœªå‘½åçš„ç»„ä»¶ï¼Œæ¯”å¦‚ `export default () => {}`ï¼Œå› ä¸ºè¿™æ ·ä¼šä½¿å¾—è°ƒè¯•å˜å¾—å¼‚å¸¸å›°éš¾ã€‚

> Notes: ä¸ºäº†å‡å°‘åœ¨é»˜è®¤å¯¼å‡ºå’Œå…·åå¯¼å‡ºä¹‹é—´çš„æ··æ·†ï¼Œä¸€äº›å›¢é˜Ÿä¼šé€‰æ‹©åªä½¿ç”¨ä¸€ç§é£æ ¼ï¼ˆé»˜è®¤æˆ–è€…å…·åï¼‰ï¼Œæˆ–è€…ç¦æ­¢åœ¨å•ä¸ªæ–‡ä»¶å†…æ··åˆä½¿ç”¨ã€‚

## 6. React çš„ Refs å±æ€§

### 6.1. ç®€è¿°

- React æ”¯æŒä¸€ç§éå¸¸ç‰¹æ®Šçš„å±æ€§ Ref ï¼Œä½ å¯ä»¥ç”¨æ¥ç»‘å®šåˆ° `render()` è¾“å‡ºçš„ä»»ä½•ç»„ä»¶ä¸Šã€‚
- è¿™ä¸ªç‰¹æ®Šçš„å±æ€§å…è®¸ä½ å¼•ç”¨ `render()` è¿”å›çš„ç›¸åº”çš„æ”¯æ’‘å®ä¾‹ï¼ˆbacking instanceï¼‰ã€‚è¿™æ ·å°±å¯ä»¥ç¡®ä¿åœ¨ä»»ä½•æ—¶é—´æ€»æ˜¯æ‹¿åˆ°æ­£ç¡®çš„å®ä¾‹ã€‚
- ref å±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚

### 6.2. ä½¿ç”¨æ–¹æ³•

ç»‘å®šä¸€ä¸ª ref å±æ€§åˆ° render çš„è¿”å›å€¼ä¸Š

```jsx
<input ref="myInput" />
```

åœ¨å…¶å®ƒä»£ç ä¸­ï¼Œå¯ä»¥é€šè¿‡ this.refs è·å–å¯¹åº”çš„æ”¯æ’‘å®ä¾‹

```jsx
var input = this.refs.myInput;
var inputValue = input.value;
var inputRect = input.getBoundingClientRect();
```

### 6.3. ç¤ºä¾‹ä»£ç 

é€šè¿‡ä½¿ç”¨ this æ¥è·å–å½“å‰ React ç»„ä»¶ï¼Œæˆ–ä½¿ç”¨ ref æ¥è·å–ç»„ä»¶çš„å¼•ç”¨

```jsx
var MyComponent = React.createClass({
  handleClick: function() {
    // ä½¿ç”¨åŸç”Ÿçš„ DOM API è·å–ç„¦ç‚¹
    this.refs.myInput.focus();
  },
  render: function() {
    //  å½“ç»„ä»¶æ’å…¥åˆ° DOM åï¼Œref å±æ€§æ·»åŠ ä¸€ä¸ªç»„ä»¶çš„å¼•ç”¨äºåˆ° this.refs
    return (
      <div>
        <input type="text" ref="myInput" />
        <input
          type="button"
          value="ç‚¹æˆ‘è¾“å…¥æ¡†è·å–ç„¦ç‚¹"
          onClick={this.handleClick}
        />
      </div>
    );
  }
});

ReactDOM.render(
  <MyComponent />,
  document.getElementById('example')
);
```

## 7. Model
### 7.1. æ•°æ®åˆ†å±‚

![åº”ç”¨åˆ†å±‚ç¤ºä¾‹å›¾](images/20190423105354679_26362.png)

- ä¸Šå›¾ä¸­å·¦ä¾§æ˜¯æœåŠ¡ç«¯ä»£ç çš„å±‚æ¬¡ç»“æ„ï¼Œç”± Controllerã€Serviceã€Data Access ä¸‰å±‚ç»„æˆæœåŠ¡ç«¯ç³»ç»Ÿ
    - Controller å±‚è´Ÿè´£ä¸ç”¨æˆ·ç›´æ¥æ‰“äº¤é“ï¼Œæ¸²æŸ“é¡µé¢ã€æä¾›æ¥å£ç­‰ï¼Œä¾§é‡äºå±•ç¤ºå‹é€»è¾‘ã€‚
    - Service å±‚è´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¾› Controller å±‚è°ƒç”¨ã€‚
    - Data Access å±‚é¡¾åæ€ä¹‰ï¼Œè´Ÿè´£ä¸æ•°æ®æºå¯¹æ¥ï¼Œè¿›è¡Œçº¯ç²¹çš„æ•°æ®è¯»å†™ï¼Œä¾› Service å±‚è°ƒç”¨ã€‚
- ä¸Šå›¾çš„å³ä¾§æ˜¯å‰ç«¯ä»£ç çš„ç»“æ„ï¼ŒåŒæ ·éœ€è¦è¿›è¡Œå¿…è¦çš„åˆ†å±‚ï¼š
    - Page è´Ÿè´£ä¸ç”¨æˆ·ç›´æ¥æ‰“äº¤é“ï¼šæ¸²æŸ“é¡µé¢ã€æ¥å—ç”¨æˆ·çš„æ“ä½œè¾“å…¥ï¼Œä¾§é‡äºå±•ç¤ºå‹äº¤äº’æ€§é€»è¾‘ã€‚
    - Model è´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¸º Page åšæ•°æ®ã€çŠ¶æ€çš„è¯»å†™ã€å˜æ¢ã€æš‚å­˜ç­‰ã€‚
    - Service è´Ÿè´£ä¸ HTTP æ¥å£å¯¹æ¥ï¼Œè¿›è¡Œçº¯ç²¹çš„æ•°æ®è¯»å†™ã€‚

### 7.2. ä½¿ç”¨ DVA æ¡†æ¶è¿›è¡Œæ•°æ®åˆ†å±‚ç®¡ç†ï¼ˆå¥½å®¢ç§Ÿæˆ¿é¡¹ç›®ä½¿ç”¨ï¼Œå…¶ä»–é¡¹ç›®ä¸ä¸€å®šä½¿ç”¨ï¼‰

dva æ˜¯åŸºäº reduxã€redux-saga å’Œ react-router çš„è½»é‡çº§å‰ç«¯æ¡†æ¶ã€‚å®˜ç½‘ï¼šhttps://dvajs.com/

#### 7.2.1. å¼•å…¥ dva æ¡†æ¶

å¼•å…¥dvaæ¡†æ¶ï¼Œç”±äºumiå¯¹dvaè¿›è¡Œäº†æ•´åˆï¼Œæ‰€ä»¥å¯¼å…¥æ—¶åªéœ€è¦ä¿®æ”¹umié¡¹ç›®ä¸­çš„config.jsæ–‡ä»¶ï¼Œè¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

```js
export default {
    plugins: [
        ['umi-plugin-react', {
            dva: true // å¼€å¯dvaåŠŸèƒ½
        }]
    ]
};
```

#### 7.2.2. å®šä¹‰ state æ•°æ®

åˆ›å»º model æ–‡ä»¶å¤¹ï¼Œåœ¨ umi ä¸­ï¼Œçº¦å®šåœ¨ src/models æ–‡ä»¶å¤¹ä¸­å®šä¹‰ modelï¼Œæ‰€ä»¥ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»º ListData.js æ–‡ä»¶

![modelé¡¹ç›®æ¶æ„](images/20190423110648086_8414.png)

å°†æ­¤å‰å®šä¹‰åœ¨ç»„ä»¶ä¸­çš„ state å‰ªåˆ‡åˆ° ListData.js æ–‡ä»¶ä¸­

```js
export default {
    namespace: 'list',
    state: {
        data: [1, 2, 3],
        maxNum: 3
    }
}
```

å¯¹ä¹‹å‰å®šä¹‰çš„ List.jsx ç»„ä»¶è¿›è¡Œä¿®æ”¹

```jsx
import React from 'react';  // å¼•å…¥react
import { connect } from 'dva';  // å¼•å…¥dvaæ¡†æ¶

// å®šä¹‰å˜é‡ï¼Œéœ€è¦å¼•å…¥çš„modelçš„å‘½åç©ºé—´
const namespace = 'list';

const mapStateToProps = (state) => {
    const listData = state[namespace].data; // è·å–ï¼š[1, 2, 3]
    return {
        listData
    };
};

/* å‚æ•°1ï¼šå‡½æ•°ï¼Œå°†modelä¸­çš„stateæ•°æ®æ˜ å°„åˆ°this.propsä¸­ */
@connect(mapStateToProps)
class List extends React.Component {
    render() {
        return (
            <div>
                <ul>
                    {
                        // éå†å€¼
                        this.props.listData.map((value, index) => {
                            return <li key={index}>{value}</li>
                        })
                    }
                </ul>
                <button
                    onClick={() => { //ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        // let maxNum = this.state.maxNum + 1;
                        // let list = [...this.state.dataList, maxNum];
                        // this.setState({ //æ›´æ–°çŠ¶æ€å€¼
                        //     dataList : list,
                        //     maxNum : maxNum
                        // });
                    }}>
                    æ·»åŠ 
                </button>
            </div>
        );
    }
}

export default List;
```

æµ‹è¯•ä¼šçœ‹åˆ°éå†å¯¹åº”çš„æ•°æ®

**æµç¨‹è¯´æ˜ï¼š**

1. umiæ¡†æ¶å¯åŠ¨ï¼Œä¼šè‡ªåŠ¨è¯»å–modelsç›®å½•ä¸‹modelæ–‡ä»¶ï¼Œå³ListData.jsä¸­çš„æ•°æ®
2. `@connect`ä¿®é¥°ç¬¦çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¿…é¡»è¿”å›`{}`å¯¹è±¡ï¼Œå°†æ¥æ”¶åˆ°modelæ•°æ®
3. åœ¨å…¨å±€çš„æ•°æ®ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šmodelæ•°æ®ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡namespaceè¿›è¡ŒåŒºåˆ†ï¼Œç„¶åé€šè¿‡`state[namespace]`è¿›è¡Œè·å–æ•°æ®
4. æ‹¿åˆ°modelæ•°æ®ä¸­stateå±æ€§ä¸‹çš„dataæ•°æ®ï¼Œä¹Ÿå°±æ˜¯`[1, 2, 3]`æ•°æ®ï¼Œè¿›è¡ŒåŒ…è£¹`{}`åè¿”å›
5. è¿”å›çš„æ•°æ®ï¼Œå°†è¢«å°è£…åˆ°`this.props`ä¸­ï¼Œæ‰€ä»¥é€šè¿‡`this.props.listData`å³å¯è·å–åˆ°modelä¸­çš„æ•°æ®

#### 7.2.3. æ›´æ–°stateæ•°æ®

æ­¤å‰é€šè¿‡`this.setState()`å¯ä»¥ä¿®æ”¹ç»„ä»¶ä¸­çš„stateå±æ€§å€¼ï¼Œä»è€Œä½¿reactå»åˆ·æ–°é¡µé¢ã€‚

1. ä½¿ç”¨dvaæ¡†æ¶å¯¹modleæ•°æ®è¿›è¡Œåˆ†å±‚åï¼Œéœ€è¦åœ¨model(æ¡ˆä¾‹ä¸­çš„ListData.js)ä¸­æ–°å¢reducersæ–¹æ³•ï¼Œç”¨äºæ›´æ–°stateä¸­çš„æ•°æ®

```js
export default {
    namespace: 'list',
    state: {
        data: [1, 2, 3],
        maxNum: 3
    },
    reducers: {
        addNewData(state) { // stateæ˜¯æ›´æ–°å‰çš„å¯¹è±¡
            let maxNum = state.maxNum + 1;
            // ä½¿ç”¨...æ‰©å±•è¿ç®—ç¬¦ï¼Œåˆ›å»ºæ–°çš„æ•°ç»„
            let list = [...state.data, maxNum];
            return { // è¿”å›æ›´æ–°åçš„stateå¯¹è±¡
                data: list,
                maxNum: maxNum
            }
        }
    }
}
```

2. ä¿®æ”¹List.jsæ–°å¢ç‚¹å‡»äº‹ä»¶

```jsx
import React from 'react';  // å¼•å…¥react
import { connect } from 'dva';  // å¼•å…¥dvaæ¡†æ¶

// å®šä¹‰å˜é‡ï¼Œéœ€è¦å¼•å…¥çš„modelçš„å‘½åç©ºé—´
const namespace = 'list';

/* å®šä¹‰æ˜ å°„æ•°æ®çš„å‡½æ•° */
const mapStateToProps = (state) => {
    const listData = state[namespace].data; // è·å–ï¼š[1, 2, 3]
    const maxNum = state[namespace].maxNum;
    return {
        listData,
        maxNum
    };
};

/* å®šä¹‰æ˜ å°„äº‹ä»¶ï¼ˆæ–¹æ³•ï¼‰çš„å‡½æ•° */
const mapDispatchToProps = (dispatch) => { // å®šä¹‰æ–¹æ³•ï¼Œdispatchæ˜¯å†…ç½®å‡½æ•°
    return { // è¿”å›çš„è¿™ä¸ªå¯¹è±¡å°†ç»‘å®šåˆ°this.propså¯¹è±¡ä¸­
        addNewData: () => { // å®šä¹‰æ–¹æ³•
            dispatch({ // é€šè¿‡è°ƒç”¨dispatch()æ–¹æ³•ï¼Œè°ƒç”¨modelä¸­reducersçš„æ–¹æ³•
                type: namespace + "/addNewData" // æŒ‡å®šæ–¹æ³•ï¼Œæ ¼å¼ï¼šnamespace/æ–¹æ³•å
            });
        }
    }
}

/**
 * å‚æ•°1ï¼šå‡½æ•°ï¼Œå°†modelä¸­çš„stateå±æ€§ä¸­å®šä¹‰çš„æ•°æ®æ˜ å°„åˆ°this.propsä¸­
 * å‚æ•°2ï¼šå‡½æ•°ï¼Œå°†modelä¸­reducerså±æ€§ä¸­å®šä¹‰çš„æ–¹æ³•æ˜ å°„åˆ°this.propsä¸­
 */
@connect(mapStateToProps, mapDispatchToProps)
class List extends React.Component {
    render() {
        return (
            <div>
                <ul>
                    {
                        // éå†å€¼
                        this.props.listData.map((value, index) => {
                            return <li key={index}>{value}</li>
                        })
                    }
                </ul>
                <button onClick={() => { this.props.addNewData() }}>
                    æ·»åŠ 
                </button>
            </div>
        );
    }
}

export default List;
```

ç»‘å®šæ–¹æ³•æµç¨‹æ¢³ç†å¦‚ä¸‹

![DVAæ¡†æ¶ç»‘å®šæ–¹æ³•æµç¨‹](images/20190423123128283_25306.png)

### 7.3. åœ¨modelä¸­è¯·æ±‚æ•°æ®

å®ç°åŠ¨æ€æŸ¥è¯¢åå°è·å–modelé‡Œçš„æ•°æ®

1. åœ¨srcä¸‹åˆ›å»ºutilç›®å½•ï¼Œæ–°å»ºrequest.jsæ–‡ä»¶ï¼ˆç”¨äºå®šä¹‰å¼‚æ­¥è¯·æ±‚åç«¯çš„å·¥å…·jsï¼‰ï¼Œè¾“å…¥å¦‚ä¸‹å†…å®¹

```js
// import fetch from 'dva/fetch';
function checkStatus(response) {
    if (response.status >= 200 && response.status < 300) {
        return response;
    }
    const error = new Error(response.statusText);
    error.response = response;
    throw error;
}

/**
 * Requests a URL, returning a promise.
 *
 * @param  {string} url       The URL we want to request
 * @param  {object} [options] The options we want to pass to "fetch"
 * @return {object}           An object containing either "data" or "err"
 */
export default async function request(url, options) {
    const response = await fetch(url, options);
    checkStatus(response);
    return await response.json();
}
```

2. ä¿®æ”¹modelï¼ˆå³ListData.jsï¼‰ä¸­æ–°å¢è¯·æ±‚æ–¹æ³•ï¼Œéœ€è¦å®šä¹‰effectsé…ç½®ï¼Œç”¨äºå¼‚æ­¥åŠ è½½æ•°æ®

```js
// å¯¼å…¥è¯·æ±‚å·¥å…·js
import request from '../util/request';

export default {
    namespace: 'list',
    state: {
        data: [],
        maxNum: 0
    },
    reducers: {
        addNewData(state, result) { // stateæ˜¯æ›´æ–°å‰çš„å¯¹è±¡ï¼›resultå°±æ˜¯æ‹¿åˆ°çš„ç»“æœæ•°æ®

            // åˆ¤æ–­resultä¸­çš„dataæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œè¯´æ˜æ˜¯åˆå§‹åŒ–æ•°æ®ï¼Œç›´æ¥è¿”å›
            if (result.data) {
                return result.data;
            }

            let maxNum = state.maxNum + 1;
            // ä½¿ç”¨...æ‰©å±•è¿ç®—ç¬¦ï¼Œåˆ›å»ºæ–°çš„æ•°ç»„
            let list = [...state.data, maxNum];
            return { // è¿”å›æ›´æ–°åçš„stateå¯¹è±¡
                data: list,
                maxNum: maxNum
            }
        }
    },
    effects: { // æ–°å¢effectsé…ç½®ï¼Œç”¨äºå¼‚æ­¥åŠ è½½æ•°æ®
        *initData(params, sagaEffects) { // å®šä¹‰å¼‚æ­¥æ–¹æ³•
            const { call, put } = sagaEffects; // è·å–åˆ°callã€putæ–¹æ³•
            const url = "/ds/list"; // å®šä¹‰è¯·æ±‚çš„url
            let data = yield call(request, url); // æ‰§è¡Œè¯·æ±‚
            yield put({ // è°ƒç”¨reducersä¸­çš„æ–¹æ³•
                type: "addNewData", // æŒ‡å®šæ–¹æ³•å
                data: data // ä¼ é€’ajaxå›æ¥çš„æ•°æ®
            });
        }
    }
}
```

3. ä¿®æ”¹é¡µé¢(List.jsx)é€»è¾‘

```jsx
import React from 'react';  // å¼•å…¥react
import { connect } from 'dva';  // å¼•å…¥dvaæ¡†æ¶

// å®šä¹‰å˜é‡ï¼Œéœ€è¦å¼•å…¥çš„modelçš„å‘½åç©ºé—´
const namespace = 'list';

/* å®šä¹‰æ˜ å°„æ•°æ®çš„å‡½æ•° */
const mapStateToProps = (state) => {
    const listData = state[namespace].data; // è·å–ï¼š[1, 2, 3]
    const maxNum = state[namespace].maxNum;
    return {
        listData,
        maxNum
    };
};

/* å®šä¹‰æ˜ å°„äº‹ä»¶ï¼ˆæ–¹æ³•ï¼‰çš„å‡½æ•° */
const mapDispatchToProps = (dispatch) => { // å®šä¹‰æ–¹æ³•ï¼Œdispatchæ˜¯å†…ç½®å‡½æ•°
    return { // è¿”å›çš„è¿™ä¸ªå¯¹è±¡å°†ç»‘å®šåˆ°this.propså¯¹è±¡ä¸­
        addNewData: () => { // å®šä¹‰æ–¹æ³•
            dispatch({ // é€šè¿‡è°ƒç”¨dispatch()æ–¹æ³•ï¼Œè°ƒç”¨modelä¸­reducersçš„æ–¹æ³•
                type: namespace + "/addNewData" // æŒ‡å®šæ–¹æ³•ï¼Œæ ¼å¼ï¼šnamespace/æ–¹æ³•å
            });
        },
        /* å®šä¹‰modelä¸­çš„åˆå§‹åŒ–æ–¹æ³• */
        initData: () => {
            dispatch({
                type: `${namespace}/initData`	// ä½¿ç”¨ES6å­—ç¬¦ä¸²æ¨¡æ¿æ ‡è®°
            });
        }
    }
}

/**
 * å‚æ•°1ï¼šå‡½æ•°ï¼Œå°†modelä¸­çš„stateå±æ€§ä¸­å®šä¹‰çš„æ•°æ®æ˜ å°„åˆ°this.propsä¸­
 * å‚æ•°2ï¼šå‡½æ•°ï¼Œå°†modelä¸­reducerså±æ€§ä¸­å®šä¹‰çš„æ–¹æ³•æ˜ å°„åˆ°this.propsä¸­
 */
@connect(mapStateToProps, mapDispatchToProps)
class List extends React.Component {

    /* å®šä¹‰ç”Ÿå‘½å‘¨æœŸçš„é’©å­æ–¹æ³•-ç»„ä»¶æŒ‚è½½åè°ƒç”¨ */
    componentDidMount() {
        this.props.initData(); // ç»„ä»¶åŠ è½½å®Œåè¿›è¡Œåˆå§‹åŒ–æ“ä½œ
    }

    render() {
        return (
            <div>
                <ul>
                    {
                        // éå†å€¼
                        this.props.listData.map((value, index) => {
                            return <li key={index}>{value}</li>
                        })
                    }
                </ul>
                <button onClick={() => { this.props.addNewData() }}>
                    æ·»åŠ 
                </button>
            </div>
        );
    }
}

export default List;
```

æµ‹è¯•ç»“æœï¼Œå‘ç°ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯è¿”å›çš„æ˜¯htmlä»£ç ï¼Œæ•°æ®ä¸æ˜¯jsonå¯¼è‡´è§£æå‡ºé”™ã€‚

![](images/20190423135417136_22756.png)

![](images/20190423135552070_25083.png)

### 7.4. mockæ•°æ®

umiä¸­æ”¯æŒå¯¹è¯·æ±‚çš„æ¨¡æ‹Ÿï¼Œå½“æ²¡æœ‰åç«¯æœåŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨mockæ•°æ®è¿›è¡Œæµ‹è¯•

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºmockç›®å½•ï¼Œç„¶ååˆ›å»ºMockListData.jsæ–‡ä»¶ï¼Œå¹¶ä¸”è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š

```js
export default {
    'get /ds/list': function (req, res) { // æ¨¡æ‹Ÿè¯·æ±‚è¿”å›æ•°æ®
        res.json({
            data: [1, 2, 3, 4],
            maxNum: 4
        });
    }
}
```

## 8. React å…¶ä»–èµ„æ–™

### 8.1. React ç›¸å…³èµ„æº

**ä¼˜è´¨ React UI åº“**ï¼š

- [Ant Design å®˜ç½‘](https://ant-design.gitee.io/index-cn) - åŠ©åŠ›è®¾è®¡å¼€å‘è€…ã€Œæ›´çµæ´»ã€åœ°æ­å»ºå‡ºã€Œæ›´ç¾ã€çš„äº§å“ï¼Œè®©ç”¨æˆ·ã€Œå¿«ä¹å·¥ä½œã€ï½
- [Ant Design Pro å®˜ç½‘](https://ant-design-pro.gitee.io/zh-CN) - å¼€ç®±å³ç”¨çš„ä¸­å°å‰ç«¯/è®¾è®¡è§£å†³æ–¹æ¡ˆ
- [Ant Design Mobile å®˜ç½‘](https://mobile.ant.design/zh) - æ¢ç´¢ç§»åŠ¨ç«¯ Web çš„æè‡´ä½“éªŒ
- [MATERIAL-UI](https://v4.mui.com/zh/) - React ç»„ä»¶ç”¨äºæ›´å¿«é€Ÿã€æ›´ç®€ä¾¿çš„ web å¼€å‘ã€‚ä½ ä¹Ÿå¯ä»¥å»ºç«‹ä½ è‡ªå·±çš„è®¾è®¡ç³»ç»Ÿï¼Œæˆ–è€…ä» Material Design å¼€å§‹ã€‚

**React å·¥å…· Github ä»“åº“**ï¼š

- [awesome-react reactèµ„æºå¤§å…¨ï¼Œè¯¥æœ‰çš„éƒ½æœ‰äº†](https://github.com/enaqx/awesome-react)
- [react-developer-roadmap reactçš„å­¦ä¹ è·¯çº¿å›¾2018ç‰ˆ](https://github.com/adam-golab/react-developer-roadmap)
- [react-bits reactæœ€ä½³å®è·µï¼Œæœ‰ä½ æƒ³çŸ¥é“](https://github.com/vasanthk/react-bits)
- [react-bits reactæœ€ä½³å®è·µä¸­æ–‡ç‰ˆ](https://github.com/hateonion/react-bits-CN)
- react-in-patterns react å¼€å‘è®¾è®¡æ¨¡å¼  star: 9903
- create-react-app facebook å®˜æ–¹æä¾› react å¼€å‘å‘½ä»¤å·¥å…·ï¼Œè§£å†³åˆå­¦è€…çš„å„ç§çƒ¦æ¼  star: 54549
- next.js reactæœåŠ¡ç«¯æ¸²æŸ“æ¡†æ¶  star: 28519 view
- [gatsby é™æ€é¡µé¢ç”Ÿæˆå™¨ï¼Œéå¸¸å¼ºå¤§ï¼Œè‡ªå®šèƒ½åŠ›å¼ºï¼Œæ¨¡ç‰ˆæå¤š](https://github.com/gatsbyjs/gatsby)
- preact reactçš„ç˜¦èº«ç‰ˆï¼Œå…¼å®¹å®˜æ–¹reactæ‰€æœ‰api,å‹ç¼©ååªæœ‰3kb  star: 19912
- recharts d3å›¾è¡¨åº“çš„reactç‰ˆ  star: 9706 view
- Sortable reactçš„æ‹–æ‹½æ’åºç»„ä»¶  star: 14180 view
- react-loadable reactç»„ä»¶æ‡’åŠ è½½ç»„ä»¶  star: 9932
- react-dnd reactæ‹–æ‹½ç»„ä»¶ï¼Œæ»¡è¶³å„ç§æ‹–æ‹½éœ€æ±‚  star: 9218 view
- react-grid-layout å¯æ‹–æ‹½çš„ä¼¸ç¼©çš„å¸ƒå±€ç»„ä»¶ï¼Œadmin dashboardå¿…å¤‡ç²¾é€‰ï¼Œå¾ˆé«˜å¤§ä¸Š recommand star: 6950 view
- docz åŸºäºreactå¼€å‘çš„å†™æ–‡æ¡£çš„ç¥å™¨,å·ç§° å†™æ–‡æ¡£ä»æœªå¦‚æ­¤ç®€å• recommand star: 9670 view
- react-spring å†™reactåŠ¨ç”»çš„å¥½å¸®æ‰‹ï¼Œä¸åºŸè¯çœ‹æ ·ä¾‹  star: 7074 view
- react-360 react VR å¼€å‘æ¡†æ¶  star: 6364 view
- taro ä¸€å¥—éµå¾ª React è¯­æ³•è§„èŒƒçš„ å¤šç«¯å¼€å‘ è§£å†³æ–¹æ¡ˆ, æœ‰ä¸€å¥—ä»£ç å¤šç«¯ç¼–è¯‘ï¼Œé€‚ç”¨å°ç¨‹åºä¸åŸç”Ÿapp  star: 7296 view
- ink ç”¨ react å¼€å‘å‘½ä»¤è¡Œäº¤äº’å·¥å…·ï¼Œå¾ˆé…·  star: 6252
- ag-grid éå¸¸å¼ºå¤§çš„tableç»„ä»¶ï¼Œå®Œå…¨æ»¡è¶³ä»¥æ•°æ®ä¸ºä¸»çš„æ•°æ®å±•ç¤ºè¡¨æ ¼  star: 4231
