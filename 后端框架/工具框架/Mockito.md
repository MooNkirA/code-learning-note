## 1. Mockito 简介

Mockito 是最流行的 Java mock 框架之一.

### 1.1. 官方资料

- [Mockito 官方网站](https://site.mockito.org/)
- [PowerMockito Github](https://github.com/powermock/powermock/)

### 1.2. 什么是 Mock 测试

Mock 测试就是在测试过程中，对于某些不容易构造（如 `HttpServletRequest` 必须在 Servlet 容器中才能构造出来）或者不容易获取比较复杂的对象（如 JDBC 中的 ResultSet 对象），创建一个虚拟的对象（Mock 对象）来替代，以便测试的测试方法。

Mock 最大的功能是把单元测试的耦合分解开，如果代码对另一个类或者接口有依赖，它能够模拟这些依赖，并验证所调用的依赖的行为。

### 1.3. Mock 适用场景

对于一些应用场景，是非常适合使用 Mock 的：

- 真实对象具有不可确定的行为(产生不可预测的结果，如股票的行情)
- 真实对象很难被创建(比如具体的web容器)
- 真实对象的某些行为很难触发(比如网络错误)
- 真实情况令程序的运行速度很慢
- 真实对象有用户界面
- 测试需要询问真实对象它是如何被调用的(比如测试可能需要验证某个回调函数是否被调用了)
- 真实对象实际上并不存在(当需要和其他开发小组，或者新的硬件系统打交道的时候，这是一个普遍的问题)

也有一些不得不使用 Mock 的场景：

- 一些比较难构造的 Object：这类 Object 通常有很多依赖，在单元测试中构造出这样类通常花费的成本太大。
- 执行操作的时间较长 Object：有一些 Object 的操作费时，而被测对象依赖于这一个操作的执行结果，例如大文件写操作，数据的更新等等，出于测试的需求，通常将这类操作进行 Mock。
- 异常逻辑：一些异常的逻辑往往在正常测试中是很难触发的，通过 Mock 可以人为的控制触发异常逻辑。

在一些压力测试的场景下，也不得不使用 Mock，例如在分布式系统测试中，通常需要测试一些单点（如 namenode，jobtracker）在压力场景下的工作是否正常。而通常测试集群在正常逻辑下无法提供足够的压力（主要原因是受限于机器数量），这时候就需要应用 Mock 去满足。

## 2. Mockito 基础使用

### 2.1. 引入 maven 依赖

## 3. PowerMock (单元测试模拟框架)

> TODO: 详细使用参考阿里的《Java工程师必读手册.pdf》电子书的[Java单元测试系列]章节

### 3.1. PowerMock 概述

#### 3.1.1. 为什么要使用 Mock 工具

在做单元测试的时候，会发现在要测试的方法会引用很多外部依赖的对象，比如：（发送邮件，网络通讯，远程服务，文件系统等等）。而又没法控制这些外部依赖的对象，为了解决这个问题，就需要用到 Mock 工具来模拟这些外部依赖的对象，来完成单元测试。

#### 3.1.2. PowerMock 简介

PowerMock 是一个扩展了其它如 EasyMock 等 mock 框架的、功能更加强大的框架。PowerMock 使用一个自定义类加载器和字节码操作来模拟静态方法，构造函数，final 类和方法，私有方法，去除静态初始化器等等。通过使用自定义的类加载器，简化采用的 IDE 或持续集成服务器不需要做任何改变。

PowerMock 能够完美的弥补如今比较流行的 jMock 、EasyMock 、Mockito 三个 Mock 工具，不能 mock 静态、final、私有方法等的缺点

熟悉 PowerMock 支持的 mock 框架的开发人员会发现 PowerMock 很容易使用，因为对于静态方法和构造器来说，整个的期望 API 是一样的。PowerMock 旨在用少量的方法和注解扩展现有的 API 来实现额外的功能。目前PowerMock 支持 EasyMock 和 Mockito。

### 3.2. PowerMock 基础使用

#### 3.2.1. 相关注解

- `@RunWith(PowerMockRunner.class)`
- `@PrepareForTest({ YourClassWithEgStaticMethod.class })`





